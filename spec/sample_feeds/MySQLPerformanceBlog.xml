<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	>

<channel>
	<title>MySQL Performance Blog</title>
	<atom:link href="http://www.mysqlperformanceblog.com/feed/" rel="self" type="application/rss+xml" />
	<link>http://www.mysqlperformanceblog.com</link>
	<description>Everything about MySQL Performance</description>
	<pubDate>Thu, 22 Jan 2009 01:48:21 +0000</pubDate>
	<generator>http://wordpress.org/?v=2.5.1</generator>
	<language>en</language>
			<item>
		<title>Beware:  ext3 and sync-binlog do not play well together</title>
		<link>http://www.mysqlperformanceblog.com/2009/01/21/beware-ext3-and-sync-binlog-do-not-play-well-together/</link>
		<comments>http://www.mysqlperformanceblog.com/2009/01/21/beware-ext3-and-sync-binlog-do-not-play-well-together/#comments</comments>
		<pubDate>Thu, 22 Jan 2009 00:42:28 +0000</pubDate>
		<dc:creator>peter</dc:creator>
		
		<category><![CDATA[hardware]]></category>

		<category><![CDATA[operating systems]]></category>

		<guid isPermaLink="false">http://www.mysqlperformanceblog.com/?p=594</guid>
		<description><![CDATA[One of our customers reported strange problem with MySQL having extremely poor performance when sync-binlog=1  is enabled, even though the system with RAID and BBU were expected to have much better performance. 
The problem could be repeated with SysBench as follows:
PLAIN TEXT
CODE:




./sysbench --num-threads=2 --test=oltp --oltp-test-mode=complex --oltp-table-size=100000 --oltp-distinct-ranges=0 --oltp-order-ranges=0 --oltp-sum-ranges=0 --oltp-simple-ranges=0 --oltp-point-selects=0 --oltp-range-size=0 --mysql-table-engine=innodb&#160; --mysql-user=root [...]]]></description>
			<content:encoded><![CDATA[<p>One of our customers reported strange problem with MySQL having extremely poor performance when <strong>sync-binlog=1</strong>  is enabled, even though the system with RAID and BBU were expected to have much better performance. </p>
<p>The problem could be repeated with SysBench as follows:</p>
<div class="igBar"><span id="lcode-2"><a href="#" onclick="javascript:showPlainTxt('code-2'); return false;">PLAIN TEXT</a></span></div>
<div class="syntax_hilite"><span class="langName">CODE:</span>
<div id="code-2">
<div class="code">
<ol>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">./sysbench --num-threads=<span style="color:#800000;color:#800000;">2</span> --test=oltp --oltp-test-mode=complex --oltp-table-size=<span style="color:#800000;color:#800000;">100000</span> --oltp-distinct-ranges=<span style="color:#800000;color:#800000;">0</span> --oltp-order-ranges=<span style="color:#800000;color:#800000;">0</span> --oltp-sum-ranges=<span style="color:#800000;color:#800000;">0</span> --oltp-simple-ranges=<span style="color:#800000;color:#800000;">0</span> --oltp-point-selects=<span style="color:#800000;color:#800000;">0</span> --oltp-range-size=<span style="color:#800000;color:#800000;">0</span> --mysql-table-engine=innodb&nbsp; --mysql-user=root --max-requests=<span style="color:#800000;color:#800000;">0</span> --max-time=<span style="color:#800000;color:#800000;">60</span> --mysql-db=test run </div>
</li>
</ol>
</div>
</div>
</div>
<p></p>
<p>On Dell R900 with  CentOS 5.2  and ext3 filesystem we get   <strong>1060 transactions/sec </strong> with single thread and sync_binlog=1  while with 2  threads it drops to  <strong>610 transactions/sec</strong>     Because of synchronous serialized writes to binlog we're not expecting significant improvements in transaction rate (as the load is binlog fsync bound) but   we surely do not expect it to drop ether. </p>
<p>To ensure this is not RAID controller related we repeated the run on the in memory block device and got very similar results -  <strong>2350 transactions/sec</strong> with 2 threads with sync-binlog=0  and just <strong>750 transactions/sec</strong> with sync-binlog=1   </p>
<p>We tried running <strong>data=writeback </strong> and <strong>data=journal</strong> just to make sure but  results were basically the same. </p>
<p>Using <strong>XFS </strong>  instead of EXT3 gives expected results - we get <strong>2350 transactions/sec</strong> with sync_binlog=1 and  <strong>2550 transactions/sec </strong>with sync-binlog=0 which is about 10% overhead.</p>
<p>EXT2 filesystem also behaves similar to XFS so it seems to be EXT3 specific performance issue.  We do not know if it is CentOS/RHEL specific and if it is fixed in the recent kernels.  If somebody can run the same test with different kernels it would be interesting to know results. </p>
<p>You also may wonder how could this problem be unnoticed for a while ?   First it only applies to the binary log.   Innodb transactional log does not have the same problem on EXT3.   I expect this is because Innodb log is pre-allocated so there is not need to modify meta data with each write while binary log is written as growing file.   Another possible reason is small sizes of writes which are being fsync'ed with binary log.  Though these are just my speculations - we did not investigate it in details. </p>
<p>Another reason is - it only happens with high transaction commit rate.  If you're just running couple of hundreds of durable commits a second you may not notice this problem.</p>
<p>Third -  <strong>sync-binlog=1</strong> is an option great for safety but it is surely not the most commonly used one.  The web applications which often have highest transaction rates typically do not have so strong durability requirements to run this option.</p>
<p>As the call for action - I would surely like someone to see if EXT3 can be fixed in this regard as it is by far the most common file system for Linux. It is also worth to investigate if something can be done on MySQL side  - may be opening binlog with O_DSYNC flag if sync_binlog=1 instead of using fsync will help ?  Or may be binlog pre-allocation  would be good solution. </p>
    <hr noshade style="margin:0;height:1px" />
    <p>Entry posted by peter |
      <a href="http://www.mysqlperformanceblog.com/2009/01/21/beware-ext3-and-sync-binlog-do-not-play-well-together/#comments">7 comments</a></p>
    <p>Add to: <a href="http://del.icio.us/post?url=http://www.mysqlperformanceblog.com/2009/01/21/beware-ext3-and-sync-binlog-do-not-play-well-together/&amp;title=Beware:  ext3 and sync-binlog do not play well together" title="Bookmark this post on del.icio.us"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/delicious.png" alt="delicious" /></a> | <a href="http://digg.com/submit?phase=2&amp;url=http://www.mysqlperformanceblog.com/2009/01/21/beware-ext3-and-sync-binlog-do-not-play-well-together/&amp;title=Beware:  ext3 and sync-binlog do not play well together" title="Digg this post on Digg.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/digg.png" alt="digg" /></a> | <a href="http://reddit.com/submit?url=http://www.mysqlperformanceblog.com/2009/01/21/beware-ext3-and-sync-binlog-do-not-play-well-together/&amp;title=Beware:  ext3 and sync-binlog do not play well together" title="Submit this post on reddit.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/reddit.png" alt="reddit" /></a> | <a href="http://www.netscape.com/submit/?U=http://www.mysqlperformanceblog.com/2009/01/21/beware-ext3-and-sync-binlog-do-not-play-well-together/&amp;T=Beware:  ext3 and sync-binlog do not play well together" title="Vote for this article on Netscape"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/netscape.gif" alt="netscape" /></a> | <a href="http://www.google.com/bookmarks/mark?op=add&amp;bkmk=http://www.mysqlperformanceblog.com/2009/01/21/beware-ext3-and-sync-binlog-do-not-play-well-together/&amp;title=Beware:  ext3 and sync-binlog do not play well together" title="Add to Google Bookmarks"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/google.png" alt="Google Bookmarks" /></a></p>]]></content:encoded>
			<wfw:commentRss>http://www.mysqlperformanceblog.com/2009/01/21/beware-ext3-and-sync-binlog-do-not-play-well-together/feed/</wfw:commentRss>
		</item>
		<item>
		<title>Profiling MySQL stored routines</title>
		<link>http://www.mysqlperformanceblog.com/2009/01/19/profiling-mysql-stored-routines/</link>
		<comments>http://www.mysqlperformanceblog.com/2009/01/19/profiling-mysql-stored-routines/#comments</comments>
		<pubDate>Mon, 19 Jan 2009 09:33:39 +0000</pubDate>
		<dc:creator>Aurimas Mikalauskas</dc:creator>
		
		<category><![CDATA[community]]></category>

		<category><![CDATA[tips]]></category>

		<category><![CDATA[tools]]></category>

		<category><![CDATA[tuning]]></category>

		<guid isPermaLink="false">http://www.mysqlperformanceblog.com/?p=589</guid>
		<description><![CDATA[These days I'm working with a customer who has an application based entirely on stored routines on MySQL side. Even though I haven't worked much with stored procedures, I though it's going to be a piece of cake. In the end - it was, but there's a catch.
My initial idea was - I'll just analyze [...]]]></description>
			<content:encoded><![CDATA[<p>These days I'm working with a customer who has an application based entirely on stored routines on MySQL side. Even though I haven't worked much with stored procedures, I though it's going to be a piece of cake. In the end - it was, but there's a catch.</p>
<p>My initial idea was - I'll just analyze queries in the slow query log generated by <a title="MySQL releases with Percona patchset" href="http://www.percona.com/percona-lab.html" target="_blank">our mysql build</a> running with long_query_time=0, get the slowest ones and work on them. It wasn't really all the way I expected..</p>
<p>For a showcase I have created a function "whatstheweatherlike". Let's call it and see what shows up in the slow query log:</p>
<div class="igBar"><span id="lsql-5"><a href="#" onclick="javascript:showPlainTxt('sql-5'); return false;">PLAIN TEXT</a></span></div>
<div class="syntax_hilite"><span class="langName">SQL:</span>
<div id="sql-5">
<div class="sql">
<ol>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">mysql&gt; <span style="color: #993333; font-weight: bold;">SELECT</span> whatstheweatherlike<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #cc66cc;color:#800000;">5</span><span style="color:#006600; font-weight:bold;">&#41;</span>;</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">----------------------------------------------------------+</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">| whatstheweatherlike<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #cc66cc;color:#800000;">5</span><span style="color:#006600; font-weight:bold;">&#41;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">----------------------------------------------------------+</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">| Its <span style="color: #cc66cc;color:#800000;">5</span>°C, time <span style="color: #993333; font-weight: bold;">IS</span> <span style="color: #cc66cc;color:#800000;">02</span>:<span style="color: #cc66cc;color:#800000;">28</span>:<span style="color: #cc66cc;color:#800000;">05</span>, feels <span style="color:#006600; font-weight:bold;">&#91;</span><span style="color: #993333; font-weight: bold;">LIKE</span><span style="color:#006600; font-weight:bold;">&#93;</span> almost summer!&nbsp; &nbsp;|</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">----------------------------------------------------------+</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #cc66cc;color:#800000;">1</span> row <span style="color: #993333; font-weight: bold;">IN</span> <span style="color: #993333; font-weight: bold;">SET</span> <span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #cc66cc;color:#800000;">0</span>.<span style="color: #cc66cc;color:#800000;">00</span> sec<span style="color:#006600; font-weight:bold;">&#41;</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">host <span style="color: #808080; font-style: italic;"># tail /var/log/mysql/mysql-slow.log</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;"># Time: 090115&nbsp; 2:25:28</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;"># User@Host: me[me] @ localhost []</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;"># Thread_id: 3432&nbsp; Schema: test</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;"># Query_time: 0.000695&nbsp; Lock_time: 0.000284&nbsp; Rows_sent: 1&nbsp; Rows_examined: 0&nbsp; Rows_affected: 0&nbsp; Rows_read: 1</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;"># QC_Hit: No&nbsp; Full_scan: No&nbsp; Full_join: No&nbsp; Tmp_table: No&nbsp; Tmp_table_on_disk: No</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;"># Filesort: No&nbsp; Filesort_on_disk: No&nbsp; Merge_passes: 0</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;"># No InnoDB statistics available for this query</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #993333; font-weight: bold;">SELECT</span> whatstheweatherlike<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #cc66cc;color:#800000;">5</span><span style="color:#006600; font-weight:bold;">&#41;</span>; </div>
</li>
</ol>
</div>
</div>
</div>
<p></p>
<p>Not overly useful for query optimization, is it? Well, I can still aggregate the slow query log with <a title="Maatkit log parser" href="http://www.maatkit.org/doc/mk-log-parser.html" target="_blank">mk-log-parser</a> and find routines that MySQL spends most of the time on, but I don't want to go over the complicated logic of stored procedure just to figure out what queries are being executed. This is where <a title="MySQL SHOW PROFILE patch" href="http://lists.mysql.com/internals/33768" target="_blank">Jeremy's SHOW PROFILE patch</a> - which is included in all Community tree based Percona MySQL builds since it is part of MySQL community version ever since 5.0.37 (note - not all Percona builds are done on Community tree) - comes into play. Let me show you how this works:</p>
<div class="igBar"><span id="lsql-6"><a href="#" onclick="javascript:showPlainTxt('sql-6'); return false;">PLAIN TEXT</a></span></div>
<div class="syntax_hilite"><span class="langName">SQL:</span>
<div id="sql-6">
<div class="sql">
<ol>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">mysql&gt; <span style="color: #993333; font-weight: bold;">SET</span> profiling=<span style="color: #cc66cc;color:#800000;">1</span>;</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">Query OK, <span style="color: #cc66cc;color:#800000;">0</span> rows affected <span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #cc66cc;color:#800000;">0</span>.<span style="color: #cc66cc;color:#800000;">00</span> sec<span style="color:#006600; font-weight:bold;">&#41;</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">mysql&gt; <span style="color: #993333; font-weight: bold;">SELECT</span> whatstheweatherlike<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #cc66cc;color:#800000;">3</span><span style="color:#006600; font-weight:bold;">&#41;</span>;</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">-----------------------------------------------------------+</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">| whatstheweatherlike<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #cc66cc;color:#800000;">3</span><span style="color:#006600; font-weight:bold;">&#41;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">-----------------------------------------------------------+</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">| Its <span style="color: #cc66cc;color:#800000;">3</span>°C, time <span style="color: #993333; font-weight: bold;">IS</span> <span style="color: #cc66cc;color:#800000;">02</span>:<span style="color: #cc66cc;color:#800000;">43</span>:<span style="color: #cc66cc;color:#800000;">25</span>, feels <span style="color:#006600; font-weight:bold;">&#91;</span><span style="color: #993333; font-weight: bold;">LIKE</span><span style="color:#006600; font-weight:bold;">&#93;</span> snow <span style="color: #993333; font-weight: bold;">IS</span> melting&nbsp; &nbsp;| </div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">-----------------------------------------------------------+</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #cc66cc;color:#800000;">1</span> row <span style="color: #993333; font-weight: bold;">IN</span> <span style="color: #993333; font-weight: bold;">SET</span> <span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #cc66cc;color:#800000;">0</span>.<span style="color: #cc66cc;color:#800000;">00</span> sec<span style="color:#006600; font-weight:bold;">&#41;</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">mysql&gt; <span style="color: #993333; font-weight: bold;">SHOW</span> profiles;</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">----------+------------+-------------------------------------------------------------+</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">| Query_ID | Duration&nbsp; &nbsp;| Query&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">----------+------------+-------------------------------------------------------------+</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">|&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #cc66cc;color:#800000;">1</span> | <span style="color: #cc66cc;color:#800000;">0</span>.<span style="color: #cc66cc;color:#800000;">00005100</span> | <span style="color: #993333; font-weight: bold;">SELECT</span> CURTIME<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color: #993333; font-weight: bold;">INTO</span> time&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">|&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #cc66cc;color:#800000;">2</span> | <span style="color: #cc66cc;color:#800000;">0</span>.<span style="color: #cc66cc;color:#800000;">00014100</span> | <span style="color: #993333; font-weight: bold;">SELECT</span> feeling <span style="color: #993333; font-weight: bold;">INTO</span> feels <span style="color: #993333; font-weight: bold;">FROM</span> weather <span style="color: #993333; font-weight: bold;">WHERE</span> temp = in_temp |</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">----------+------------+-------------------------------------------------------------+</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #cc66cc;color:#800000;">2</span> rows <span style="color: #993333; font-weight: bold;">IN</span> <span style="color: #993333; font-weight: bold;">SET</span> <span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #cc66cc;color:#800000;">0</span>.<span style="color: #cc66cc;color:#800000;">00</span> sec<span style="color:#006600; font-weight:bold;">&#41;</span> </div>
</li>
</ol>
</div>
</div>
</div>
<p></p>
<p>So now not only do we get to see what queres were executed, how much time they spent executing but we can also get a profile for each of the queries individually. I think this is pretty cool and it helped me a lot. Sure, you may still need to check routine and track the logic so having constants that were used rather than variables would be even more useful. Nevertheless I think this is a great way to find what's happening under the scenes so you could start digging deeper.</p>
<p>On the other hand, this way of manual profiling you can't really see real time stats, for example if it was slow because of locks, in the logs you may not see it. I will ask my colleagues to check if it would be hard to implement configurable variable for switching between routine and query logging, so maybe one day we'll be able to have both ways of looking at it.</p>
    <hr noshade style="margin:0;height:1px" />
    <p>Entry posted by Aurimas Mikalauskas |
      <a href="http://www.mysqlperformanceblog.com/2009/01/19/profiling-mysql-stored-routines/#comments">No comment</a></p>
    <p>Add to: <a href="http://del.icio.us/post?url=http://www.mysqlperformanceblog.com/2009/01/19/profiling-mysql-stored-routines/&amp;title=Profiling MySQL stored routines" title="Bookmark this post on del.icio.us"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/delicious.png" alt="delicious" /></a> | <a href="http://digg.com/submit?phase=2&amp;url=http://www.mysqlperformanceblog.com/2009/01/19/profiling-mysql-stored-routines/&amp;title=Profiling MySQL stored routines" title="Digg this post on Digg.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/digg.png" alt="digg" /></a> | <a href="http://reddit.com/submit?url=http://www.mysqlperformanceblog.com/2009/01/19/profiling-mysql-stored-routines/&amp;title=Profiling MySQL stored routines" title="Submit this post on reddit.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/reddit.png" alt="reddit" /></a> | <a href="http://www.netscape.com/submit/?U=http://www.mysqlperformanceblog.com/2009/01/19/profiling-mysql-stored-routines/&amp;T=Profiling MySQL stored routines" title="Vote for this article on Netscape"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/netscape.gif" alt="netscape" /></a> | <a href="http://www.google.com/bookmarks/mark?op=add&amp;bkmk=http://www.mysqlperformanceblog.com/2009/01/19/profiling-mysql-stored-routines/&amp;title=Profiling MySQL stored routines" title="Add to Google Bookmarks"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/google.png" alt="Google Bookmarks" /></a></p>]]></content:encoded>
			<wfw:commentRss>http://www.mysqlperformanceblog.com/2009/01/19/profiling-mysql-stored-routines/feed/</wfw:commentRss>
		</item>
		<item>
		<title>Fix of InnoDB/XtraDB scalability of rollback segment</title>
		<link>http://www.mysqlperformanceblog.com/2009/01/18/partial-fix-of-innodb-scalability-rollback-segments/</link>
		<comments>http://www.mysqlperformanceblog.com/2009/01/18/partial-fix-of-innodb-scalability-rollback-segments/#comments</comments>
		<pubDate>Sun, 18 Jan 2009 21:34:11 +0000</pubDate>
		<dc:creator>Vadim</dc:creator>
		
		<category><![CDATA[Innodb]]></category>

		<category><![CDATA[benchmarks]]></category>

		<category><![CDATA[xtradb]]></category>

		<guid isPermaLink="false">http://www.mysqlperformanceblog.com/?p=590</guid>
		<description><![CDATA[Recently I wrote about InnoDB scalability on 24-core box, and we made research of scalability problems in sysbench write workload (benchmark emulates intensive insert/delete queries). By our results the problem is in concurrency on rollback segment, which by default is single and all transactions are serialized accessing to segment.
Fortunately InnoDB internally has mechanism to support [...]]]></description>
			<content:encoded><![CDATA[<p>Recently I wrote about <a href="http://www.mysqlperformanceblog.com/2008/12/29/xtradbinnodb-cpu-bound-benchmarks-on-24cores-server/">InnoDB scalability on 24-core box</a>, and we made research of scalability problems in sysbench write workload (benchmark emulates intensive insert/delete queries). By our results the problem is in concurrency on rollback segment, which by default is single and all transactions are serialized accessing to segment.<br />
Fortunately InnoDB internally has mechanism to support multiple rollback segments - and Yasufumi just made patch to enable it.</p>
<p>I rerun benchmarks on different server (Dell PowerEdge R900, 16-way Intel Xeon, 32GB of RAM, RAID 10 on 8 disks) to compare mysql-5.1.30-XtraDB-1.0.2-pre-release3 with default (1) and 16 rollback segments.</p>
<p><a href='http://www.mysqlperformanceblog.com/wp-content/uploads/2009/01/sysbench-ins-del.png'><img src="http://www.mysqlperformanceblog.com/wp-content/uploads/2009/01/sysbench-ins-del.png" alt="" title="sysbench-ins-del" width="500" height="306" class="alignnone size-full wp-image-592" /></a></p>
<p>For reference<br />
MySQL parameters:</p>
<div class="igBar"><span id="lcode-9"><a href="#" onclick="javascript:showPlainTxt('code-9'); return false;">PLAIN TEXT</a></span></div>
<div class="syntax_hilite"><span class="langName">CODE:</span>
<div id="code-9">
<div class="code">
<ol>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color:#006600; font-weight:bold;">&#91;</span>mysqld<span style="color:#006600; font-weight:bold;">&#93;</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">#mysqld options in alphabetical order</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">user=root</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">default_table_type=MYISAM</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_buffer_pool_size=6G</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_data_file_path=ibdata1:10M:autoextend</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_file_per_table=<span style="color:#800000;color:#800000;">1</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_flush_log_at_trx_commit=<span style="color:#800000;color:#800000;">2</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_log_buffer_size=8M</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_log_files_in_group=<span style="color:#800000;color:#800000;">2</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_log_file_size=128M</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_thread_concurrency=<span style="color:#800000;color:#800000;">0</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_extra_rsegments=<span style="color:#800000;color:#800000;">16</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">max_connections=<span style="color:#800000;color:#800000;">3000</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">query_cache_size=<span style="color:#800000;color:#800000;">0</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">skip-name-resolve</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">table_cache=<span style="color:#800000;color:#800000;">2048</span> </div>
</li>
</ol>
</div>
</div>
</div>
<p></p>
<p>sysbench parameters</p>
<div class="igBar"><span id="lcode-10"><a href="#" onclick="javascript:showPlainTxt('code-10'); return false;">PLAIN TEXT</a></span></div>
<div class="syntax_hilite"><span class="langName">CODE:</span>
<div id="code-10">
<div class="code">
<ol>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">/data/vadim/benchwork/benchmarks/sysbench/bin/sysbench --num-threads <span style="color:#800000;color:#800000;">1</span> --max-requests <span style="color:#800000;color:#800000;">0</span> --max-time <span style="color:#800000;color:#800000;">300</span> --thread-stack-size 32K --init-rng on --validate off --test oltp --oltp-test-mode complex --oltp-sp-name&nbsp; --oltp-read-only off --oltp-skip-trx off --oltp-range-size&nbsp; --oltp-point-selects&nbsp; --oltp-simple-ranges&nbsp; --oltp-sum-ranges&nbsp; --oltp-order-ranges&nbsp; --oltp-distinct-ranges&nbsp; --oltp-index-updates&nbsp; --oltp-non-index-updates&nbsp; --oltp-nontrx-mode select --oltp-auto-inc off --oltp-connect-delay <span style="color:#800000;color:#800000;">10000</span> --oltp-user-delay-min <span style="color:#800000;color:#800000;">0</span> --oltp-user-delay-max <span style="color:#800000;color:#800000;">0</span> --oltp-table-name sbtest --oltp-table-size <span style="color:#800000;color:#800000;">10000000</span> --oltp-dist-type uniform --oltp-dist-pct&nbsp; --oltp-dist-res&nbsp; --db-ps-mode auto --mysql-host localhost --mysql-port <span style="color:#800000;color:#800000;">3306</span> --mysql-socket /data/vadim/benchwork/var/mysql_benchwork.<span style="">sock</span> --mysql-user user --mysql-password&nbsp; --mysql-db sbtest --mysql-table-engine innodb --myisam-max-rows <span style="color:#800000;color:#800000;">1000000</span> run </div>
</li>
</ol>
</div>
</div>
</div>
<p></p>
    <hr noshade style="margin:0;height:1px" />
    <p>Entry posted by Vadim |
      <a href="http://www.mysqlperformanceblog.com/2009/01/18/partial-fix-of-innodb-scalability-rollback-segments/#comments">7 comments</a></p>
    <p>Add to: <a href="http://del.icio.us/post?url=http://www.mysqlperformanceblog.com/2009/01/18/partial-fix-of-innodb-scalability-rollback-segments/&amp;title=Fix of InnoDB/XtraDB scalability of rollback segment" title="Bookmark this post on del.icio.us"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/delicious.png" alt="delicious" /></a> | <a href="http://digg.com/submit?phase=2&amp;url=http://www.mysqlperformanceblog.com/2009/01/18/partial-fix-of-innodb-scalability-rollback-segments/&amp;title=Fix of InnoDB/XtraDB scalability of rollback segment" title="Digg this post on Digg.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/digg.png" alt="digg" /></a> | <a href="http://reddit.com/submit?url=http://www.mysqlperformanceblog.com/2009/01/18/partial-fix-of-innodb-scalability-rollback-segments/&amp;title=Fix of InnoDB/XtraDB scalability of rollback segment" title="Submit this post on reddit.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/reddit.png" alt="reddit" /></a> | <a href="http://www.netscape.com/submit/?U=http://www.mysqlperformanceblog.com/2009/01/18/partial-fix-of-innodb-scalability-rollback-segments/&amp;T=Fix of InnoDB/XtraDB scalability of rollback segment" title="Vote for this article on Netscape"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/netscape.gif" alt="netscape" /></a> | <a href="http://www.google.com/bookmarks/mark?op=add&amp;bkmk=http://www.mysqlperformanceblog.com/2009/01/18/partial-fix-of-innodb-scalability-rollback-segments/&amp;title=Fix of InnoDB/XtraDB scalability of rollback segment" title="Add to Google Bookmarks"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/google.png" alt="Google Bookmarks" /></a></p>]]></content:encoded>
			<wfw:commentRss>http://www.mysqlperformanceblog.com/2009/01/18/partial-fix-of-innodb-scalability-rollback-segments/feed/</wfw:commentRss>
		</item>
		<item>
		<title>Dropping unused indexes</title>
		<link>http://www.mysqlperformanceblog.com/2009/01/15/dropping-unused-indexes/</link>
		<comments>http://www.mysqlperformanceblog.com/2009/01/15/dropping-unused-indexes/#comments</comments>
		<pubDate>Thu, 15 Jan 2009 08:14:27 +0000</pubDate>
		<dc:creator>peter</dc:creator>
		
		<category><![CDATA[tips]]></category>

		<guid isPermaLink="false">http://www.mysqlperformanceblog.com/?p=588</guid>
		<description><![CDATA[Vadim wrote some time ago about how to find unused indexes with single query.  
I was working on the system today and found hundreds of unused indexes on dozens of tables so just dropping indexes manually did not look fun.  So I extended Vadim's query to generate ALTER TABLE statements automatically.  I [...]]]></description>
			<content:encoded><![CDATA[<p>Vadim <a href="http://www.mysqlperformanceblog.com/2008/09/12/unused-indexes-by-single-query/">wrote</a> some time ago about how to find unused indexes with single query.  </p>
<p>I was working on the system today and found hundreds of unused indexes on dozens of tables so just dropping indexes manually did not look fun.  So I extended Vadim's query to generate ALTER TABLE statements automatically.  I also made it to look only at tables which were accessed:</p>
<div class="igBar"><span id="lsql-12"><a href="#" onclick="javascript:showPlainTxt('sql-12'); return false;">PLAIN TEXT</a></span></div>
<div class="syntax_hilite"><span class="langName">SQL:</span>
<div id="sql-12">
<div class="sql">
<ol>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">mysql&gt; <span style="color: #993333; font-weight: bold;">SELECT</span> concat<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #ff0000;">'alter table '</span>,d.table_schema,<span style="color: #ff0000;">'.'</span>,d.table_name,<span style="color: #ff0000;">' drop index '</span>,group_concat<span style="color:#006600; font-weight:bold;">&#40;</span>index_name separator <span style="color: #ff0000;">',drop index '</span><span style="color:#006600; font-weight:bold;">&#41;</span>,<span style="color: #ff0000;">';'</span><span style="color:#006600; font-weight:bold;">&#41;</span> stmt <span style="color: #993333; font-weight: bold;">FROM</span> <span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #993333; font-weight: bold;">SELECT</span> <span style="color: #993333; font-weight: bold;">DISTINCT</span> s.TABLE_SCHEMA, s.TABLE_NAME, s.INDEX_NAME <span style="color: #993333; font-weight: bold;">FROM</span> information_schema.statistics s <span style="color: #993333; font-weight: bold;">LEFT</span> <span style="color: #993333; font-weight: bold;">JOIN</span> information_schema.index_statistics iz <span style="color: #993333; font-weight: bold;">ON</span> <span style="color:#006600; font-weight:bold;">&#40;</span>s.TABLE_SCHEMA = iz.TABLE_SCHEMA <span style="color: #993333; font-weight: bold;">AND</span> s.TABLE_NAME=iz.TABLE_NAME <span style="color: #993333; font-weight: bold;">AND</span> s.INDEX_NAME=iz.INDEX_NAME<span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color: #993333; font-weight: bold;">WHERE</span> iz.TABLE_SCHEMA <span style="color: #993333; font-weight: bold;">IS</span> <span style="color: #993333; font-weight: bold;">NULL</span>&nbsp; <span style="color: #993333; font-weight: bold;">AND</span> s.NON_UNIQUE=<span style="color: #cc66cc;color:#800000;">1</span> <span style="color: #993333; font-weight: bold;">AND</span> s.INDEX_NAME!=<span style="color: #ff0000;">'PRIMARY'</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #993333; font-weight: bold;">SELECT</span> rows_read+rows_changed <span style="color: #993333; font-weight: bold;">FROM</span> information_schema.table_statistics ts <span style="color: #993333; font-weight: bold;">WHERE</span> ts.table_schema=s.table_schema <span style="color: #993333; font-weight: bold;">AND</span> ts.table_name=s.table_name<span style="color:#006600; font-weight:bold;">&#41;</span>&gt;<span style="color: #cc66cc;color:#800000;">0</span><span style="color:#006600; font-weight:bold;">&#41;</span> d <span style="color: #993333; font-weight: bold;">GROUP</span> <span style="color: #993333; font-weight: bold;">BY</span> table_schema,table_name;</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">-----------------------------------------------------------+</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">| stmt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">-----------------------------------------------------------+</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">| <span style="color: #993333; font-weight: bold;">ALTER</span> <span style="color: #993333; font-weight: bold;">TABLE</span> board.country_language <span style="color: #993333; font-weight: bold;">DROP</span> <span style="color: #993333; font-weight: bold;">INDEX</span> country_id; |</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">+<span style="color: #808080; font-style: italic;">-----------------------------------------------------------+</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #cc66cc;color:#800000;">1</span> row <span style="color: #993333; font-weight: bold;">IN</span> <span style="color: #993333; font-weight: bold;">SET</span> <span style="color:#006600; font-weight:bold;">&#40;</span><span style="color: #cc66cc;color:#800000;">0</span>.<span style="color: #cc66cc;color:#800000;">99</span> sec<span style="color:#006600; font-weight:bold;">&#41;</span> </div>
</li>
</ol>
</div>
</div>
</div>
<p></p>
<p>I however would warn against using it blindly in production.  It is possible some indexes were not used since startup but are still used... for example if you're having monthly billing or something like it. </p>
<p>However it is very helpful for testing allowing to drop all potentially not needed indexes so you can perform proper QA and ensure you really did not drop anything you needed.   In such case it would make sense to run this query in production but then do changes in test envinronment first.</p>
<p>Note this query requres MySQL with <a href="http://www.percona.com/percona-lab.html">Percona Extensions</a> and user statistics running. </p>
    <hr noshade style="margin:0;height:1px" />
    <p>Entry posted by peter |
      <a href="http://www.mysqlperformanceblog.com/2009/01/15/dropping-unused-indexes/#comments">5 comments</a></p>
    <p>Add to: <a href="http://del.icio.us/post?url=http://www.mysqlperformanceblog.com/2009/01/15/dropping-unused-indexes/&amp;title=Dropping unused indexes" title="Bookmark this post on del.icio.us"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/delicious.png" alt="delicious" /></a> | <a href="http://digg.com/submit?phase=2&amp;url=http://www.mysqlperformanceblog.com/2009/01/15/dropping-unused-indexes/&amp;title=Dropping unused indexes" title="Digg this post on Digg.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/digg.png" alt="digg" /></a> | <a href="http://reddit.com/submit?url=http://www.mysqlperformanceblog.com/2009/01/15/dropping-unused-indexes/&amp;title=Dropping unused indexes" title="Submit this post on reddit.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/reddit.png" alt="reddit" /></a> | <a href="http://www.netscape.com/submit/?U=http://www.mysqlperformanceblog.com/2009/01/15/dropping-unused-indexes/&amp;T=Dropping unused indexes" title="Vote for this article on Netscape"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/netscape.gif" alt="netscape" /></a> | <a href="http://www.google.com/bookmarks/mark?op=add&amp;bkmk=http://www.mysqlperformanceblog.com/2009/01/15/dropping-unused-indexes/&amp;title=Dropping unused indexes" title="Add to Google Bookmarks"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/google.png" alt="Google Bookmarks" /></a></p>]]></content:encoded>
			<wfw:commentRss>http://www.mysqlperformanceblog.com/2009/01/15/dropping-unused-indexes/feed/</wfw:commentRss>
		</item>
		<item>
		<title>Some little known facts about Innodb Insert Buffer</title>
		<link>http://www.mysqlperformanceblog.com/2009/01/13/some-little-known-facts-about-innodb-insert-buffer/</link>
		<comments>http://www.mysqlperformanceblog.com/2009/01/13/some-little-known-facts-about-innodb-insert-buffer/#comments</comments>
		<pubDate>Wed, 14 Jan 2009 03:53:14 +0000</pubDate>
		<dc:creator>peter</dc:creator>
		
		<category><![CDATA[Innodb]]></category>

		<guid isPermaLink="false">http://www.mysqlperformanceblog.com/?p=587</guid>
		<description><![CDATA[Despite being standard Innodb feature forever Insert Buffers remains some kind of mysterious thing for a lot of people, so let me try to explain thing a little bit.
Innodb uses insert buffer to "cheat" and not to update index leaf pages when at once but "buffer" such updates so several updates to the same page [...]]]></description>
			<content:encoded><![CDATA[<p>Despite being standard Innodb feature forever Insert Buffers remains some kind of mysterious thing for a lot of people, so let me try to explain thing a little bit.</p>
<p>Innodb uses insert buffer to "cheat" and not to update index leaf pages when at once but "buffer" such updates so several updates to the same page can be performed with single sweep.     Insert buffer only can work for non-unique keys because until the merge is performed it is impossible to check if the value is unique.</p>
<p>Insert buffer is allocated in the Innodb system table space. Even though it is called "buffer" similar to "doublewrite buffer" it is really the space in the tablepace.  Though it can be cached in the buffer pool same as other pages.   This property allows insert buffer to survive transaction commits and even MySQL restarts.  Really it may take <strong>weeks</strong> before the given index page is merged, though usually it is much sooner than that.</p>
<p>There are two ways of insert buffer merge is happening. First is on demand merge - if accessed page contains unmerged records in insert buffer the merge is performed before page is made available.  This means insert buffer can slow down read operations.  </p>
<p>The other way insert buffer is merged is by background thread.  There are very little merges happening if system is loaded and merge process becomes more active if system is idle.   This behavior can cause interesting results, like you had system lightly used and have very little IO activity, but when you remove the load from the system completely you see high IO load which goes for hours even after all buffer pool dirty pages are completed.   This can be very surprising.  </p>
<p>Stats about Innodb Insert Merge Buffer are available in <strong>SHOW INNODB STATUS</strong> output:</p>
<p><code><br />
-------------------------------------<br />
INSERT BUFFER AND ADAPTIVE HASH INDEX<br />
-------------------------------------<br />
Ibuf: size 7545, free list len 3790, seg size 11336,<br />
8075308 inserts, 7540969 merged recs, 2246304 merges<br />
</code></p>
<p>The "seg size" is a full allocated size of segment in pages.  So in this case it is about 180MB<br />
The "free list" is number of pages which are free - containing no unmerged records.  The "size" is size (in pages) of insert buffer which is not merged. </p>
<p>The fact size is in pages is not really helpful because depending on the row size there can be different number of rows in the insert buffer - and it is rows we see in performance stats, for example to understand when insert buffer merge will be completed. </p>
<p>The "inserts" is number of inserts to insert buffer since start and number of merged records is number of records which were merged to their appropriate page locations since start.  So we know in this case insert buffer has grown 534339 records since start.       There is a temptation to use this number as count of unmerged rows in insert buffer but this would not be correct - insert buffer may not be empty at the start.  So you can only tell insert buffer has at least this number of records.  For the same reason do not get scared if you see more merged records than inserted. </p>
<p>The value of 2246304 merges shows us there was about 3 records merged for each merge operation, meaning insert buffer could in theory reduce IO needed to update leaf pages 3 times. </p>
<p>As I mentioned Insert buffer merge can take quite a while - with 100 records merged per second we're looking at least 5343 seconds or 1.5 hours on this server... and there are insert buffers which are 10x and 100x larger than this.</p>
<p>Innodb unfortunately offers no control for insert buffer while it surely would be benefiting for different workloads and hardware configuration.  For example there is very good question if insert buffer really makes sense for SSD because saving random IO is not so much needed for these devices.</p>
    <hr noshade style="margin:0;height:1px" />
    <p>Entry posted by peter |
      <a href="http://www.mysqlperformanceblog.com/2009/01/13/some-little-known-facts-about-innodb-insert-buffer/#comments">4 comments</a></p>
    <p>Add to: <a href="http://del.icio.us/post?url=http://www.mysqlperformanceblog.com/2009/01/13/some-little-known-facts-about-innodb-insert-buffer/&amp;title=Some little known facts about Innodb Insert Buffer" title="Bookmark this post on del.icio.us"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/delicious.png" alt="delicious" /></a> | <a href="http://digg.com/submit?phase=2&amp;url=http://www.mysqlperformanceblog.com/2009/01/13/some-little-known-facts-about-innodb-insert-buffer/&amp;title=Some little known facts about Innodb Insert Buffer" title="Digg this post on Digg.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/digg.png" alt="digg" /></a> | <a href="http://reddit.com/submit?url=http://www.mysqlperformanceblog.com/2009/01/13/some-little-known-facts-about-innodb-insert-buffer/&amp;title=Some little known facts about Innodb Insert Buffer" title="Submit this post on reddit.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/reddit.png" alt="reddit" /></a> | <a href="http://www.netscape.com/submit/?U=http://www.mysqlperformanceblog.com/2009/01/13/some-little-known-facts-about-innodb-insert-buffer/&amp;T=Some little known facts about Innodb Insert Buffer" title="Vote for this article on Netscape"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/netscape.gif" alt="netscape" /></a> | <a href="http://www.google.com/bookmarks/mark?op=add&amp;bkmk=http://www.mysqlperformanceblog.com/2009/01/13/some-little-known-facts-about-innodb-insert-buffer/&amp;title=Some little known facts about Innodb Insert Buffer" title="Add to Google Bookmarks"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/google.png" alt="Google Bookmarks" /></a></p>]]></content:encoded>
			<wfw:commentRss>http://www.mysqlperformanceblog.com/2009/01/13/some-little-known-facts-about-innodb-insert-buffer/feed/</wfw:commentRss>
		</item>
		<item>
		<title>Percona welcomes Ryan Lowe and Vladimir Fedorkov</title>
		<link>http://www.mysqlperformanceblog.com/2009/01/13/percona-welcomes-ryan-lowe-and-vladimir-fedorkov/</link>
		<comments>http://www.mysqlperformanceblog.com/2009/01/13/percona-welcomes-ryan-lowe-and-vladimir-fedorkov/#comments</comments>
		<pubDate>Wed, 14 Jan 2009 01:03:44 +0000</pubDate>
		<dc:creator>Baron Schwartz</dc:creator>
		
		<category><![CDATA[percona]]></category>

		<guid isPermaLink="false">http://www.mysqlperformanceblog.com/?p=585</guid>
		<description><![CDATA[As we've said before, the Percona team just  keeps growing.  This time around, I'm pleased to welcome Ryan and Vladimir.
Ryan Lowe initially joined us from Florida (USA) in June.  In his previous lives he scaled an Alexa top 1000 site with a sharded MySQL backend, worked in aerospace, worked in telecom, and [...]]]></description>
			<content:encoded><![CDATA[<p>As we've said before, the Percona team just  <a href="http://www.mysqlperformanceblog.com/2008/10/01/percona-welcomes-ewen-fortune-and-piotr-biel/">keeps</a> <a href="http://www.mysqlperformanceblog.com/2008/11/01/yasufumi-kinoshita-joins-percona/">growing</a>.  This time around, I'm pleased to welcome Ryan and Vladimir.</p>
<p>Ryan Lowe initially joined us from Florida (USA) in June.  In his previous lives he scaled an Alexa top 1000 site with a sharded MySQL backend, worked in aerospace, worked in telecom, and lots of other things.  His background as a consultant, DBA (with Oracle, too!), DBA manager, and programmer makes him a great match for Percona's clients.  He also contributed some improvements to Wordpress, and he blogs here and on <a href="http://www.pablowe.net/">Pablowe</a>.</p>
<p>Vladimir Fedorkov joins us from Lipetsk in the Russian Federation.  (Brrr!)  Vladimir and Peter have known each other and worked together for years in past endeavors.  Vladimir can make Sphinx do just about anything, and is an expert systems administrator too.  (Did you know that we provide systems administration services to our clients?  It's not all about query optimization.)  Vladimir is also the leader of one of our groups of consultants (codename: Mercury) and is helping us solidify core parts of our services offerings.</p>
<p>Vladimir and Ryan, a big welcome -- we are fortunate indeed you're working with us.  And... go team!</p>
<p><small>PS: I can't help but triple-dip, and point out that our own <a href="http://www.mysql.com/certification/candidates.php?exam=5">Ewen Fortune has been a MySQL Cluster Certified DBA</a> for quite a long time now.  OK, shameless plug over.  And, <a href="http://www.pythian.com/blogs/1439/pythian-adds-another-certified-mysql-cluster-dba">congratulations Nicklas</a>!</small></p>
    <hr noshade style="margin:0;height:1px" />
    <p>Entry posted by Baron Schwartz |
      <a href="http://www.mysqlperformanceblog.com/2009/01/13/percona-welcomes-ryan-lowe-and-vladimir-fedorkov/#comments">3 comments</a></p>
    <p>Add to: <a href="http://del.icio.us/post?url=http://www.mysqlperformanceblog.com/2009/01/13/percona-welcomes-ryan-lowe-and-vladimir-fedorkov/&amp;title=Percona welcomes Ryan Lowe and Vladimir Fedorkov" title="Bookmark this post on del.icio.us"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/delicious.png" alt="delicious" /></a> | <a href="http://digg.com/submit?phase=2&amp;url=http://www.mysqlperformanceblog.com/2009/01/13/percona-welcomes-ryan-lowe-and-vladimir-fedorkov/&amp;title=Percona welcomes Ryan Lowe and Vladimir Fedorkov" title="Digg this post on Digg.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/digg.png" alt="digg" /></a> | <a href="http://reddit.com/submit?url=http://www.mysqlperformanceblog.com/2009/01/13/percona-welcomes-ryan-lowe-and-vladimir-fedorkov/&amp;title=Percona welcomes Ryan Lowe and Vladimir Fedorkov" title="Submit this post on reddit.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/reddit.png" alt="reddit" /></a> | <a href="http://www.netscape.com/submit/?U=http://www.mysqlperformanceblog.com/2009/01/13/percona-welcomes-ryan-lowe-and-vladimir-fedorkov/&amp;T=Percona welcomes Ryan Lowe and Vladimir Fedorkov" title="Vote for this article on Netscape"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/netscape.gif" alt="netscape" /></a> | <a href="http://www.google.com/bookmarks/mark?op=add&amp;bkmk=http://www.mysqlperformanceblog.com/2009/01/13/percona-welcomes-ryan-lowe-and-vladimir-fedorkov/&amp;title=Percona welcomes Ryan Lowe and Vladimir Fedorkov" title="Add to Google Bookmarks"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/google.png" alt="Google Bookmarks" /></a></p>]]></content:encoded>
			<wfw:commentRss>http://www.mysqlperformanceblog.com/2009/01/13/percona-welcomes-ryan-lowe-and-vladimir-fedorkov/feed/</wfw:commentRss>
		</item>
		<item>
		<title>Should you move from MyISAM to Innodb ?</title>
		<link>http://www.mysqlperformanceblog.com/2009/01/12/should-you-move-from-myisam-to-innodb/</link>
		<comments>http://www.mysqlperformanceblog.com/2009/01/12/should-you-move-from-myisam-to-innodb/#comments</comments>
		<pubDate>Mon, 12 Jan 2009 20:49:56 +0000</pubDate>
		<dc:creator>peter</dc:creator>
		
		<category><![CDATA[Innodb]]></category>

		<category><![CDATA[myisam]]></category>

		<category><![CDATA[production]]></category>

		<guid isPermaLink="false">http://www.mysqlperformanceblog.com/?p=586</guid>
		<description><![CDATA[There is significant portion of customers which are still using MyISAM when they come to us, so one of the big questions is when it is feasible to move to Innodb and when staying on MyISAM is preferred ?
I generally prefer to see Innodb as the main storage engine because it makes life much simpler [...]]]></description>
			<content:encoded><![CDATA[<p>There is significant portion of customers which are still using MyISAM when they come to us, so one of the big questions is when it is feasible to move to Innodb and when staying on MyISAM is preferred ?</p>
<p>I generally prefer to see Innodb as the main storage engine because it makes life much simpler in the end for most users - you do not get to deal with recovering tables on the crash or partially  executed statements.  Table locks is no more problem,  hot backups are easy, though there are some important things which we have to consider on case by case basics before recommending the move. </p>
<p><strong>Is MyISAM used as default or as a choice ? </strong>  This is the most important question to ask upfront.  Sometimes MyISAM is there just because it is default, in other cases this is deliberate choice with system being optimized to deal with MyISAM limits, for example there is a dedicated slave available for all long reporting queries.   In case MyISAM was chosen not just happened to be it is important to build the good argument to suggest Innodb.</p>
<p><strong>Application Readiness</strong>  Application should be ready to work with Innodb, for example be ready to deal with deadlocks which can happen with Innodb even if you do not use transactions, but which are not existent with MyISAM.     QA has to be performed as part of the move.</p>
<p><strong>Performance</strong>  Innodb has a lot to offer in terms of performance - Performance benefits and drawbacks.  On the benefits side we usually see clustering by primary key, caching data, higher concurrency,  background flushes while on the drawbacks side we see significantly large table size (especially if data size is close to memory size),  generally slower writes, slower blob handling, concurrency issues, problems dealing with very large number of tables, slow data load and ALTER TABLE and others.  Another big one is COUNT(*)  without where clause which is often the show stopper for them move until it is worked around.</p>
<p><strong>Operations</strong>   What is good for MyISAM kills Innodb,  such as copying binary tables between the servers.   It is important the team understands Innodb and knows how to handle it, or be able to learn it.  It is also important to adjust processes as required to work with Innodb.  For example binary copy of one of the databases from the Slave to the dev envinronment works great for MyISAM but does not work with Innodb.   Backup tools like "mysqlhotcopy" does not work etc.  Note Performance also affects Operations aspects a lot - for example using mysqldump as a backup may well work for MyISAM but will start taking way too much time to do restore for Innodb.  On large scale installations mysqldump does not work anyway but it may still work for you when you're running MyISAM but instantly break upon upgrading to Innodb.</p>
<p><strong>Features</strong>  The MyISAM features which forbid moving to Innodb are typically Full Text Search and RTREE indexes/GIS with Full Text  being much more common.     There are workarounds for both of them, including dedicated MyISAM slave or shadow table but it is important to consider them.</p>
<p><strong>How about Mixing Storage Engines ?</strong>  Sure you can mix storage engines but I suggest you doing is wisely.  It complicates operations tasks (backups, balancing, performance analyzes)  as well as it exercises not so common paths in the MySQL server - in particular Optimizer may have harder time because costs between storage engines may not be well balanced or replication of mixed table types which is quite complicated. </p>
<p>I prefer to pick one storage engine (typically Innodb) and when use other tables when it really gives substantial gains.  I would not switch table to MyISAM because it gives 5% performance improvement but I can perfectly use MyISAM (or Archive) for logging.</p>
<p><strong>Innodb Needs Tuning</strong>  As a final note about MyISAM to Innodb migration  I should mention about Innodb tuning.  Innodb needs tuning. Really.  MyISAM for many applications can work well with defaults.  I've seen hundreds of GB databases ran with MyISAM with default  settings and it worked reasonably.  Innodb needs resources and it will not work well with defaults a lot.   Tuning MyISAM from defaults rarely gives more than 2-3 times gain while it can be as much as 10-50 times for Innodb tables in particular for write intensive workloads.  Check <a href="http://www.mysqlperformanceblog.com/2007/11/01/innodb-performance-optimization-basics/">here</a> for details.</p>
    <hr noshade style="margin:0;height:1px" />
    <p>Entry posted by peter |
      <a href="http://www.mysqlperformanceblog.com/2009/01/12/should-you-move-from-myisam-to-innodb/#comments">27 comments</a></p>
    <p>Add to: <a href="http://del.icio.us/post?url=http://www.mysqlperformanceblog.com/2009/01/12/should-you-move-from-myisam-to-innodb/&amp;title=Should you move from MyISAM to Innodb ?" title="Bookmark this post on del.icio.us"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/delicious.png" alt="delicious" /></a> | <a href="http://digg.com/submit?phase=2&amp;url=http://www.mysqlperformanceblog.com/2009/01/12/should-you-move-from-myisam-to-innodb/&amp;title=Should you move from MyISAM to Innodb ?" title="Digg this post on Digg.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/digg.png" alt="digg" /></a> | <a href="http://reddit.com/submit?url=http://www.mysqlperformanceblog.com/2009/01/12/should-you-move-from-myisam-to-innodb/&amp;title=Should you move from MyISAM to Innodb ?" title="Submit this post on reddit.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/reddit.png" alt="reddit" /></a> | <a href="http://www.netscape.com/submit/?U=http://www.mysqlperformanceblog.com/2009/01/12/should-you-move-from-myisam-to-innodb/&amp;T=Should you move from MyISAM to Innodb ?" title="Vote for this article on Netscape"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/netscape.gif" alt="netscape" /></a> | <a href="http://www.google.com/bookmarks/mark?op=add&amp;bkmk=http://www.mysqlperformanceblog.com/2009/01/12/should-you-move-from-myisam-to-innodb/&amp;title=Should you move from MyISAM to Innodb ?" title="Add to Google Bookmarks"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/google.png" alt="Google Bookmarks" /></a></p>]]></content:encoded>
			<wfw:commentRss>http://www.mysqlperformanceblog.com/2009/01/12/should-you-move-from-myisam-to-innodb/feed/</wfw:commentRss>
		</item>
		<item>
		<title>How Percona Develops Open-Source Software</title>
		<link>http://www.mysqlperformanceblog.com/2009/01/09/how-percona-develops-open-source-software/</link>
		<comments>http://www.mysqlperformanceblog.com/2009/01/09/how-percona-develops-open-source-software/#comments</comments>
		<pubDate>Sat, 10 Jan 2009 02:22:52 +0000</pubDate>
		<dc:creator>Baron Schwartz</dc:creator>
		
		<category><![CDATA[community]]></category>

		<category><![CDATA[patch]]></category>

		<category><![CDATA[percona]]></category>

		<category><![CDATA[xtradb]]></category>

		<guid isPermaLink="false">http://www.mysqlperformanceblog.com/?p=574</guid>
		<description><![CDATA[Percona has been building and contributing to open-source software since the company was founded, and individually we've been doing the same thing for many years.  We think it's a huge value for our customers and the community.
We're involved in a dozen or so open-source projects, but our three core efforts at the moment are the [...]]]></description>
			<content:encoded><![CDATA[<p>Percona has been building and contributing to open-source software since the company was founded, and individually we've been doing the same thing for many years.  We think it's a huge value for our customers and the community.</p>
<p>We're involved in a dozen or so open-source projects, but our three core efforts at the moment are the following:</p>
<ul>
<li><a href="http://www.percona.com/percona-lab.html">Percona patches</a>, which are included in our own MySQL builds and then in OurDelta builds and perhaps others as well</li>
<li><a href="https://launchpad.net/percona-xtradb">XtraDB</a>, which is our new high-performance transactional storage engine</li>
<li><a href="http://www.maatkit.org/">Maatkit</a>, which is a toolkit that provides advanced functionality for MySQL.</li>
</ul>
<p>We have a team of dedicated MySQL developers working on the server and on ExtraDB, and a  dedicated Maatkit developer.  Other Percona employees also put significant time into these projects.</p>
<p>Outside observers have commented that our development process doesn't seem very open-source.  That is, we typically just go build the software and then announce it.  We don't involve the community very much in our decisions about what features to include, or how they should get built; and we don't encourage community contributions directly into our codebase.  There's also some ambiguity about where the money comes from and where it goes.  These are all fair points to bring up.  Peter, Vadim and I thought we should address them and let everyone know how we really work on these things and what our vision for the future is.</p>
<p><strong>How We Decide On Features</strong></p>
<p>There are at least three sources of input into how we prioritize our work.</p>
<ol>
<li><strong>Clear and present needs</strong>.  If we are crippled day in and day out by the lack of some feature, or the presence of some bug, then we will take the initiative to fix it.  The most obvious example is our enhanced slow-logging functionality, which is part of our standard patches.  These patches make it possible to learn a great deal about what your server is doing and how to optimize it.</li>
<li><strong>Customer demands</strong>.  Customers come to us and ask for the features that <em>they</em> see as clear and present needs; or they come to us with particular performance issues and we analyze it and find that the best solution is to modify the server.  Many of the other features in our patch set are in this category, as is a lot of ongoing work that's not released yet.</li>
<li><strong>The general public</strong>.  People comment on our blog posts, or send us email, and so forth.  We notice these requests, and if they come up often enough and we think they'll be useful, they start to stick in our brains and we eventually put them on the TODO list.</li>
</ol>
<p>The order of priorities is this: paying customers, obvious needs for our consulting practice, and the public wishlist.  However, even when work is sponsored by paying customers, we don't just blindly put the features into our Percona builds.  Firstly, customers get to choose whether they want us to do this.  Secondly, the builds are designed to <em>meet real-world needs</em> and we are working very carefully to enhance the MySQL server but not end up with a chaotic mix of random stuff.</p>
<p>Some features are also so specific to certain customers that we don't include them.  When we do target an improvement for our builds, it's a big win for everyone, because we share the development cost with the customer (you can think of it as an open-source discount; it is us contributing towards the public good) and we maintain the feature in subsequent minor versions of the server free of charge.  Features that we don't include in our public patch set don't get forward-ported for free, so customers pay if they want a version that is ported to a newer server.</p>
<p>In a separate category, there's also work that we do for customers which is <strong>not</strong> open-source.  We are currently customizing the MySQL server and storage engines for some of Silicon Valley's most innovative startups.  I won't talk about this any more, but I wanted to mention it for the sake of full disclosure.</p>
<p><strong>How We Support Our Work</strong></p>
<p>This work is usually supported by our customers.  (It happens, but not often, that someone just writes new functionality for free in spare time.)  However, if the work is open-source, we generally run this as a "less-for-profit" part of our business.  I'll clarify that in a minute.</p>
<p>There are generally two ways that we channel money to features.  The first is when a customer says "I want this" and pays us to build it.  In these cases, we work on a schedule to deliver the required features.  We treat it as developer-for-hire with all the normal expectations of being hired.  If we all agree that the result will be open-sourced and the general public will benefit, then we work for a discount.  We're still working for a profit -- part of our business is custom MySQL development, after all -- but we discount it.</p>
<p>The second way is when people say "here's some money for the general fund to support your <a href="http://www.percona.com/docs/wiki/devplan:start">future planned features</a>."  In this case, the money goes into the queue for when someone is available to work on the modifications, and we either pay attention to any preferences the donor has, or we use our judgment as to which enhancements will add the most value to our builds.  In practice, this second model has not happened very often; we have used it more for Maatkit and <a href="http://code.google.com/p/mysql-master-master/">MMM</a> than for server patches.  But we hope that will change as more people find out about the possibility for getting their wishes.  This model lets us work on features that everyone wants but no one wants to pay for.  And in this case we work on a non-profit basis: the developer who works on the features is paid at a special rate for "internal work" (as opposed to working for "external customers").</p>
<p>You can also think about this as dual sources for the money to support the open-source efforts.  One is customers who channel money directly to development.  (Thanks!) The other is <em>all of our customers</em> who are indirectly sponsoring the development just by being customers.  In other words, if you're a customer, you're contributing to open-source software development.  (Thanks to you, too!)</p>
<p>If you would like Percona to create custom MySQL features or builds for you, please <a href="http://www.percona.com/contacts.html">contact us</a>.</p>
<p><strong>Why We Don't Grant Commit Rights</strong></p>
<p>As far as we know, no one has ever asked for commit rights to our codebase.</p>
<p>That aside, the Percona contributions to open-source are not a potluck dinner where everyone brings something and puts it on the table.  These builds are stamped with our name and are downloadable from our website.  They're a core part of our offering to customers (and non-customers can get them for free, too).  If you're a customer, we stand behind the builds and we support them.  The builds power some of the most demanding MySQL installations in the world.  All code has to be vetted very carefully, and all features have to deliver a compelling value.</p>
<p>There's an overarching reason, though.  Percona is not the ultimate upstream source.  Community contributions ought to be going into the MySQL codebase, not the Percona codebase.  Percona's relationship to the rest of the community is that of a peer, not a parent.</p>
<p>Perhaps some of you are wondering, "why don't you contribute your patches back to MySQL?"</p>
<p>We do contribute our patches.  They are GPL-licensed, which is both generous and fair, and MySQL is free to take them without even asking permission, as long as they abide by the GPL.  We welcome <em>everyone</em> to use our patches.  OurDelta does so -- it is a great example of how the community can aggregate patches and make something greater than the sum of the parts.</p>
<p>When it comes to Sun/MySQL, we actively and openly talk to them about it, and it's an ongoing conversation.  However, there are various reasons why it's not the ultimate solution for our customers, and their interests come first.  For one thing, getting patches accepted is a somewhat laborious process, and we don't have the resources for it ourselves.  We could do it, but we'd have to pass the costs on to our customers.</p>
<p>The second thing is that it takes far too long for patches to actually show up in a GA version of the server.  Customers pay us to solve their problems <em>now</em>.  This means that one way or another, we're going to be maintaining the custom patches in our own tree and making our own builds, and there is no sense in doing a halfway job of it.  So that removes the motivation for us or our customers to try to get Sun/MySQL to accept the patches -- it wouldn't add any extra value.  We'd like Sun/MySQL to accept the patches, but with the customers' needs solved, the onus is on them to do it, which seems fair -- after all, Percona and Percona customers already co-sponsored the development, and Sun/MySQL will be reselling the results.</p>
<p>This is a large and contentious topic that has been discussed at great length elsewhere and is not appropriate to get into here in its full scope.  But I'll point out that some of our patches have been accepted in the past and there are signs that this might continue.  We certainly hope so.</p>
<p><strong>How You Can Get Your Wishes To Come True</strong></p>
<p>If you have a particular need for some modification to the MySQL server, XtraDB, Maatkit, our InnoDB data recovery tools, MMM, innotop, or even projects like standard GNU utilities, we're listening.  You can contact us through our website, and offer to sponsor the work.  There are also mailing lists for our various projects.</p>
<p>Here's an example: wouldn't it be great if there were a built-in type in MySQL that could store date and time with microsecond precision?  Lots of people have asked for that.  If you all put some money in the hat, it could become a reality.</p>
<p><strong>Where It All Begins</strong></p>
<p>Our open-source efforts flow from our <a href="http://www.percona.com/our-vision.html">company values</a>.  We believe that software and information wants to be free.  We also support innovation and entrepreneurship.  We like to combine these things when we can!  The complexity of our customers' different situations leads to the need for a lot of flexibility in our approach, which is why there are so many nuances.  And we generally try to create incentive towards what we see as the public good. That's the motivation behind our shared-development-cost model, for example -- it creates an incentive for customers to say "yes" when we ask them to agree to open-source the features.</p>
<p>Open-source is not a passing fad.  It's not a marketing gimmick for us.  It's who we are at the core.  Funding its development in a fair way is a great balancing act, and finding a balance that seems to make sense for everyone is very rewarding.</p>
    <hr noshade style="margin:0;height:1px" />
    <p>Entry posted by Baron Schwartz |
      <a href="http://www.mysqlperformanceblog.com/2009/01/09/how-percona-develops-open-source-software/#comments">3 comments</a></p>
    <p>Add to: <a href="http://del.icio.us/post?url=http://www.mysqlperformanceblog.com/2009/01/09/how-percona-develops-open-source-software/&amp;title=How Percona Develops Open-Source Software" title="Bookmark this post on del.icio.us"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/delicious.png" alt="delicious" /></a> | <a href="http://digg.com/submit?phase=2&amp;url=http://www.mysqlperformanceblog.com/2009/01/09/how-percona-develops-open-source-software/&amp;title=How Percona Develops Open-Source Software" title="Digg this post on Digg.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/digg.png" alt="digg" /></a> | <a href="http://reddit.com/submit?url=http://www.mysqlperformanceblog.com/2009/01/09/how-percona-develops-open-source-software/&amp;title=How Percona Develops Open-Source Software" title="Submit this post on reddit.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/reddit.png" alt="reddit" /></a> | <a href="http://www.netscape.com/submit/?U=http://www.mysqlperformanceblog.com/2009/01/09/how-percona-develops-open-source-software/&amp;T=How Percona Develops Open-Source Software" title="Vote for this article on Netscape"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/netscape.gif" alt="netscape" /></a> | <a href="http://www.google.com/bookmarks/mark?op=add&amp;bkmk=http://www.mysqlperformanceblog.com/2009/01/09/how-percona-develops-open-source-software/&amp;title=How Percona Develops Open-Source Software" title="Add to Google Bookmarks"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/google.png" alt="Google Bookmarks" /></a></p>]]></content:encoded>
			<wfw:commentRss>http://www.mysqlperformanceblog.com/2009/01/09/how-percona-develops-open-source-software/feed/</wfw:commentRss>
		</item>
		<item>
		<title>XtraDB storage engine release 1.0.2-2 (New Year edition)</title>
		<link>http://www.mysqlperformanceblog.com/2008/12/29/xtradb-storage-engine-release-102-2/</link>
		<comments>http://www.mysqlperformanceblog.com/2008/12/29/xtradb-storage-engine-release-102-2/#comments</comments>
		<pubDate>Tue, 30 Dec 2008 06:27:38 +0000</pubDate>
		<dc:creator>Evgeny Stepchenko</dc:creator>
		
		<category><![CDATA[percona]]></category>

		<category><![CDATA[production]]></category>

		<category><![CDATA[release]]></category>

		<category><![CDATA[xtradb]]></category>

		<guid isPermaLink="false">http://www.mysqlperformanceblog.com/?p=581</guid>
		<description><![CDATA[
Today we announce release 1.0.2-2 of our XtraDB storage engine.
Here is a list of enhancements:


split-buffer_pool_mutex


The patch splits global InnoDB buffer_pool mutex into several and eliminates waitings on flush IO and mutex when there is no enough free buffers. It helps if you have performance drops when data does not fit in memory.


innodb_extra_undoslots


InnoDB has a concurrent [...]]]></description>
			<content:encoded><![CDATA[<div class="level1">
<p>Today we announce release 1.0.2-2 of our <a class="urlextern" title="https://launchpad.net/percona-xtradb" rel="nofollow" href="https://launchpad.net/percona-xtradb">XtraDB storage engine</a>.</p>
<p>Here is a list of enhancements:</p>
<ul>
<li class="level1">
<div class="li">split-buffer_pool_mutex</div>
</li>
</ul>
<p>The patch splits global InnoDB buffer_pool mutex into several and eliminates waitings on flush IO and mutex when there is no enough free buffers. It helps if you have performance drops when data does not fit in memory.</p>
<ul>
<li class="level1">
<div class="li"><a class="urlextern" title="http://www.percona.com/docs/wiki/percona-xtradb:innodb_expand_undo_slots" rel="nofollow" href="http://www.percona.com/docs/wiki/percona-xtradb:innodb_expand_undo_slots">innodb_extra_undoslots</a></div>
</li>
</ul>
<p>InnoDB has a <a class="urlextern" title="http://bugs.mysql.com/bug.php?id=26590" rel="nofollow" href="http://bugs.mysql.com/bug.php?id=26590">concurrent transaction limit of 1024</a> because in the standard InnoDB the number of undo slots is fixed value. This patch expands the maximum number of undo slots to 4072 and allows better utilizing modern hardware. (Thank <a href="http://smugmug.com">SmugMug</a> for this feature!)</p>
<p><strong>ATTENTION</strong>: If the option was enabled and the expanded slots are used, you cannot use the datafile with system tablespace for the software which assume 1024 slots (e.g. the other mysqld or innodb hotbackup). See <a class="urlextern" title="http://www.percona.com/docs/wiki/percona-xtradb:innodb_expand_undo_slots" rel="nofollow" href="http://www.percona.com/docs/wiki/percona-xtradb:innodb_expand_undo_slots">documentation</a> for details.</p>
<p>Percona XtraDB 1.0.2-2 available :</p>
<ul>
<li class="level1">
<div class="li">in source code from <a class="urlextern" title="https://launchpad.net/percona-xtradb" rel="nofollow" href="https://launchpad.net/percona-xtradb">Launchpad</a>, the version 1.0.2-2  you can get as <em>bzr branch lp:percona-xtradb -r tag:release-1.0.2-2 percona-xtradb-1.0.2-2</em></div>
</li>
<li class="level1">
<div class="li">as <a class="urlextern" title="http://www.percona.com/mysql/5.1.30-2/source/percona-xtradb-1.0.2-2.tar.gz" rel="nofollow" href="http://www.percona.com/mysql/5.1.30-2/source/percona-xtradb-1.0.2-2.tar.gz">source code in tar.gz</a></div>
</li>
<li class="level1">
<div class="li">as <a href="http://www.percona.com/mysql/5.1.30-2/RPM/">binaries</a>, percona xtradb is compiled in into <a class="urlextern" title="http://www.percona.com/mysql/5.1.30-2/RPM/" rel="nofollow" href="http://www.percona.com/mysql/5.1.30-2/RPM/">MySQL-5.1.30 RPM</a></div>
</li>
<li class="level1">
<div class="li">as <a class="urlextern" title="http://www.percona.com/mysql/5.1.30-2/binary/percona-xtradb-1.0.2-2-5.1.30.x86_64.tar.gz" rel="nofollow" href="http://www.percona.com/mysql/5.1.30-2/binary/percona-xtradb-1.0.2-2-5.1.30.x86_64.tar.gz">separated shared library</a>, to use as drop-in plugin for existing MySQL-5.1.30 installation</div>
</li>
</ul>
<p>XtraDB is compatible with existing InnoDB tables (<strong>Warning</strong>: unless you used <strong>innodb_extra_undoslots</strong> ) and we are going to keep compatibility in further releases. We are open for features requests for new engine and ready to accept community patches. You can monitor Percona's current tasks and further plans on the <a class="urlextern" title="https://launchpad.net/percona-xtradb" rel="nofollow" href="https://launchpad.net/percona-xtradb">Percona XtraDB Launchpad project</a>. You can also <a class="urlextern" title="https://blueprints.launchpad.net/percona-xtradb" rel="nofollow" href="https://blueprints.launchpad.net/percona-xtradb">request features</a> and <a class="urlextern" title="https://bugs.launchpad.net/percona-xtradb" rel="nofollow" href="https://bugs.launchpad.net/percona-xtradb">report bugs</a> there. Also we have setup two maillists for <a class="urlextern" title="http://groups.google.com/group/percona-discussion" rel="nofollow" href="http://groups.google.com/group/percona-discussion">General discussions</a> and  for <a class="urlextern" title="http://groups.google.com/group/percona-dev" rel="nofollow" href="http://groups.google.com/group/percona-dev">Development related questions</a>.</p>
</div>
    <hr noshade style="margin:0;height:1px" />
    <p>Entry posted by Evgeny Stepchenko |
      <a href="http://www.mysqlperformanceblog.com/2008/12/29/xtradb-storage-engine-release-102-2/#comments">4 comments</a></p>
    <p>Add to: <a href="http://del.icio.us/post?url=http://www.mysqlperformanceblog.com/2008/12/29/xtradb-storage-engine-release-102-2/&amp;title=XtraDB storage engine release 1.0.2-2 (New Year edition)" title="Bookmark this post on del.icio.us"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/delicious.png" alt="delicious" /></a> | <a href="http://digg.com/submit?phase=2&amp;url=http://www.mysqlperformanceblog.com/2008/12/29/xtradb-storage-engine-release-102-2/&amp;title=XtraDB storage engine release 1.0.2-2 (New Year edition)" title="Digg this post on Digg.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/digg.png" alt="digg" /></a> | <a href="http://reddit.com/submit?url=http://www.mysqlperformanceblog.com/2008/12/29/xtradb-storage-engine-release-102-2/&amp;title=XtraDB storage engine release 1.0.2-2 (New Year edition)" title="Submit this post on reddit.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/reddit.png" alt="reddit" /></a> | <a href="http://www.netscape.com/submit/?U=http://www.mysqlperformanceblog.com/2008/12/29/xtradb-storage-engine-release-102-2/&amp;T=XtraDB storage engine release 1.0.2-2 (New Year edition)" title="Vote for this article on Netscape"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/netscape.gif" alt="netscape" /></a> | <a href="http://www.google.com/bookmarks/mark?op=add&amp;bkmk=http://www.mysqlperformanceblog.com/2008/12/29/xtradb-storage-engine-release-102-2/&amp;title=XtraDB storage engine release 1.0.2-2 (New Year edition)" title="Add to Google Bookmarks"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/google.png" alt="Google Bookmarks" /></a></p>]]></content:encoded>
			<wfw:commentRss>http://www.mysqlperformanceblog.com/2008/12/29/xtradb-storage-engine-release-102-2/feed/</wfw:commentRss>
		</item>
		<item>
		<title>XtraDB/InnoDB CPU bound benchmarks on 24cores server</title>
		<link>http://www.mysqlperformanceblog.com/2008/12/29/xtradbinnodb-cpu-bound-benchmarks-on-24cores-server/</link>
		<comments>http://www.mysqlperformanceblog.com/2008/12/29/xtradbinnodb-cpu-bound-benchmarks-on-24cores-server/#comments</comments>
		<pubDate>Mon, 29 Dec 2008 19:54:44 +0000</pubDate>
		<dc:creator>Vadim</dc:creator>
		
		<category><![CDATA[Innodb]]></category>

		<category><![CDATA[benchmarks]]></category>

		<category><![CDATA[xtradb]]></category>

		<guid isPermaLink="false">http://www.mysqlperformanceblog.com/?p=577</guid>
		<description><![CDATA[One of our customers gave me a chance to run some benchmarks on 24-core (intel cpu based) server, and I could not miss it and ran few CPU-bound tasks there.
The goal of benchmarks was investigation of InnoDB-plugin and XtraDB scalability in CPU-bound load.
CPU specification:
PLAIN TEXT
CODE:




processor&#160; &#160; &#160; &#160;: 23


vendor_id&#160; &#160; &#160; &#160;: GenuineIntel


cpu family&#160; &#160; [...]]]></description>
			<content:encoded><![CDATA[<p>One of our customers gave me a chance to run some benchmarks on 24-core (intel cpu based) server, and I could not miss it and ran few CPU-bound tasks there.</p>
<p>The goal of benchmarks was investigation of InnoDB-plugin and XtraDB scalability in CPU-bound load.</p>
<p>CPU specification:</p>
<div class="igBar"><span id="lcode-15"><a href="#" onclick="javascript:showPlainTxt('code-15'); return false;">PLAIN TEXT</a></span></div>
<div class="syntax_hilite"><span class="langName">CODE:</span>
<div id="code-15">
<div class="code">
<ol>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">processor&nbsp; &nbsp; &nbsp; &nbsp;: <span style="color:#800000;color:#800000;">23</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">vendor_id&nbsp; &nbsp; &nbsp; &nbsp;: GenuineIntel</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">cpu family&nbsp; &nbsp; &nbsp; : <span style="color:#800000;color:#800000;">6</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">model&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: <span style="color:#800000;color:#800000;">29</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">model name&nbsp; &nbsp; &nbsp; : Intel<span style="color:#006600; font-weight:bold;">&#40;</span>R<span style="color:#006600; font-weight:bold;">&#41;</span> Xeon<span style="color:#006600; font-weight:bold;">&#40;</span>R<span style="color:#006600; font-weight:bold;">&#41;</span> CPU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;E7450&nbsp; @ <span style="color:#800000;color:#800000;">2</span>.40GHz</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">stepping&nbsp; &nbsp; &nbsp; &nbsp; : <span style="color:#800000;color:#800000;">1</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">cpu MHz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: <span style="color:#800000;color:#800000;">2394</span>.<span style="color:#800000;color:#800000;">011</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">cache size&nbsp; &nbsp; &nbsp; : <span style="color:#800000;color:#800000;">12288</span> KB</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">physical id&nbsp; &nbsp; &nbsp;: <span style="color:#800000;color:#800000;">3</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">siblings&nbsp; &nbsp; &nbsp; &nbsp; : <span style="color:#800000;color:#800000;">6</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">core id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: <span style="color:#800000;color:#800000;">5</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">cpu cores&nbsp; &nbsp; &nbsp; &nbsp;: <span style="color:#800000;color:#800000;">6</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">fpu&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: yes</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">fpu_exception&nbsp; &nbsp;: yes</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">cpuid level&nbsp; &nbsp; &nbsp;: <span style="color:#800000;color:#800000;">11</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">wp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : yes</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">flags&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm syscall nx lm constant_tsc pni monitor ds_cpl vmx est tm2 cx16 xtpr lahf_lm</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">bogomips&nbsp; &nbsp; &nbsp; &nbsp; : <span style="color:#800000;color:#800000;">4788</span>.<span style="color:#800000;color:#800000;">59</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">clflush size&nbsp; &nbsp; : <span style="color:#800000;color:#800000;">64</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">cache_alignment : <span style="color:#800000;color:#800000;">64</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">address sizes&nbsp; &nbsp;: <span style="color:#800000;color:#800000;">40</span> bits physical, <span style="color:#800000;color:#800000;">48</span> bits virtual</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">power management: </div>
</li>
</ol>
</div>
</div>
</div>
<p></p>
<p>I tested MySQL-5.1.30 with InnoDB plugin, Xtradb-1.0.2-1, and XtraDB-1.0.2-2 (rel2). XtraDB-rel2 has not been released yet, we still are doing internal QA for, but it will be ready soon. Main difference XtraDB-rel2 it contains additional scalability fixes for buffer_pool (split_buffer_pool_mutex patch).</p>
<p>my.cnf is</p>
<div class="igBar"><span id="lcode-16"><a href="#" onclick="javascript:showPlainTxt('code-16'); return false;">PLAIN TEXT</a></span></div>
<div class="syntax_hilite"><span class="langName">CODE:</span>
<div id="code-16">
<div class="code">
<ol>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color:#006600; font-weight:bold;">&#91;</span>mysqld<span style="color:#006600; font-weight:bold;">&#93;</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">user=root</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">binlog_cache_size=1M</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">default_table_type=MYISAM</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">ft_min_word_len=<span style="color:#800000;color:#800000;">4</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_additional_mem_pool_size=16M</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_buffer_pool_size=15G</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_data_file_path=ibdata1:10M:autoextend</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_file_per_table=<span style="color:#800000;color:#800000;">1</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_flush_log_at_trx_commit=<span style="color:#800000;color:#800000;">2</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_log_buffer_size=8M</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_log_files_in_group=<span style="color:#800000;color:#800000;">2</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_log_file_size=512M</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_status_file=<span style="color:#800000;color:#800000;">0</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_thread_concurrency=<span style="color:#800000;color:#800000;">0</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_io_capacity=<span style="color:#800000;color:#800000;">1000</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_write_io_threads = <span style="color:#800000;color:#800000;">16</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">innodb_read_io_threads = <span style="color:#800000;color:#800000;">16</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">join_buffer_size=1M</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">max_allowed_packet=1M</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">max_connections=<span style="color:#800000;color:#800000;">3000</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">max_heap_table_size=64M</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">max_prepared_stmt_count=<span style="color:#800000;color:#800000;">1000000</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">query_cache_size=<span style="color:#800000;color:#800000;">0</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">skip_grant_tables</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">skip_locking</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">sort_buffer_size=64K</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">table_cache=<span style="color:#800000;color:#800000;">2048</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">thread_cache_size=<span style="color:#800000;color:#800000;">16</span></div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">thread_concurrency=<span style="color:#800000;color:#800000;">16</span></div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">thread_stack=196K</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">tmp_table_size=64M</div>
</li>
<li style="font-weight: bold;color:#26536A;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">transaction_isolation=REPEATABLE-READ</div>
</li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;color:#3A6A8B;">
<div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">local-infile=<span style="color:#800000;color:#800000;">1</span> </div>
</li>
</ol>
</div>
</div>
</div>
<p></p>
<p>At first I tried sysbench oltp read-only with 10mil rows (the datasize is about 2.5GB), uniform distribution.<br />
The results you can see there: (Results are removed for additional checking)</p>
<p>In the next run I tested sysbench oltp read-write load, and the results are:</p>
<p><a href='http://www.mysqlperformanceblog.com/wp-content/uploads/2008/12/1230431458-clip-29kb.png'><img src="http://www.mysqlperformanceblog.com/wp-content/uploads/2008/12/1230431458-clip-29kb.png" alt="" title="1230431458-clip-29kb" width="500" height="377" class="alignnone size-full wp-image-579" /></a></p>
<p>Here starting 16 threads the result is dropping down with the same speed as it grew, and with 128 connections we have the same TPS as with 1 connection (and it is on 24-cores box!).  XtraDB is slightly better there than InnoDB, but nothing special to be proud of. We definitely we will look how to fix it  as next step, read detailed investigation what is the reason of performance drop in next post.</p>
<p>And last one workload I tried is TPCC-like benchmark (you can get it on https://launchpad.net/perconatools), with 100 Warehouses (about 9.5GB datasize).<br />
The result is:</p>
<p><a href='http://www.mysqlperformanceblog.com/wp-content/uploads/2008/12/1230432196-clip-27kb.png'><img src="http://www.mysqlperformanceblog.com/wp-content/uploads/2008/12/1230432196-clip-27kb.png" alt="" title="1230432196-clip-27kb" width="500" height="335" class="alignnone size-full wp-image-580" /></a></p>
<p>Here the result grows up to 16 connections, but after that InnoDB-plugin is dropping down. XtraDB and XtraDB-rel2 seem quite better, I guess this is mostly because fixes to rw_locks and to buffer_pool mutex (in rel2).</p>
<p>Conclusion: As read-only workload seems fine, read-write cases is something to worry about in 16+ cores boxes.<br />
Intel Based 24 Core Servers are not mainstream these days but as number of cores is increasing now at the same pace as CPU frequency before we believe they are very soon to come. Also in real production there may be not a lot database fits "in-memory" cases  - but on other hand 64-128GB RAM per box is not something rare already and recommendation to fit at least active dataset in memory is one we use for our customers.</p>
    <hr noshade style="margin:0;height:1px" />
    <p>Entry posted by Vadim |
      <a href="http://www.mysqlperformanceblog.com/2008/12/29/xtradbinnodb-cpu-bound-benchmarks-on-24cores-server/#comments">3 comments</a></p>
    <p>Add to: <a href="http://del.icio.us/post?url=http://www.mysqlperformanceblog.com/2008/12/29/xtradbinnodb-cpu-bound-benchmarks-on-24cores-server/&amp;title=XtraDB/InnoDB CPU bound benchmarks on 24cores server" title="Bookmark this post on del.icio.us"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/delicious.png" alt="delicious" /></a> | <a href="http://digg.com/submit?phase=2&amp;url=http://www.mysqlperformanceblog.com/2008/12/29/xtradbinnodb-cpu-bound-benchmarks-on-24cores-server/&amp;title=XtraDB/InnoDB CPU bound benchmarks on 24cores server" title="Digg this post on Digg.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/digg.png" alt="digg" /></a> | <a href="http://reddit.com/submit?url=http://www.mysqlperformanceblog.com/2008/12/29/xtradbinnodb-cpu-bound-benchmarks-on-24cores-server/&amp;title=XtraDB/InnoDB CPU bound benchmarks on 24cores server" title="Submit this post on reddit.com"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/reddit.png" alt="reddit" /></a> | <a href="http://www.netscape.com/submit/?U=http://www.mysqlperformanceblog.com/2008/12/29/xtradbinnodb-cpu-bound-benchmarks-on-24cores-server/&amp;T=XtraDB/InnoDB CPU bound benchmarks on 24cores server" title="Vote for this article on Netscape"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/netscape.gif" alt="netscape" /></a> | <a href="http://www.google.com/bookmarks/mark?op=add&amp;bkmk=http://www.mysqlperformanceblog.com/2008/12/29/xtradbinnodb-cpu-bound-benchmarks-on-24cores-server/&amp;title=XtraDB/InnoDB CPU bound benchmarks on 24cores server" title="Add to Google Bookmarks"><img src="http://www.mysqlperformanceblog.com/wp-content/themes/boxy-but-gold/images/google.png" alt="Google Bookmarks" /></a></p>]]></content:encoded>
			<wfw:commentRss>http://www.mysqlperformanceblog.com/2008/12/29/xtradbinnodb-cpu-bound-benchmarks-on-24cores-server/feed/</wfw:commentRss>
		</item>
	</channel>
</rss>

<!-- Dynamic Page Served (once) in 1232679690.352 seconds -->
